# Setting Up a GitHub App for watsonx-code-reviewer

This guide will walk you through creating a GitHub App that will be used by **watsonx-code-reviewer** to receive webhook events and interact with GitHub APIs.

## Step 1: Create a New GitHub App
1. **Navigate to GitHub Settings**:
    - Go to [GitHub Settings](https://github.com/settings/apps) and click on **Developer settings**.
    - Under **GitHub Apps**, click **New GitHub App**.

2. **Basic Information**:
    - **GitHub App name**: Choose a descriptive name, e.g., "watsonx-code-reviewer".
    - **Homepage URL**: Use your repository URL or documentation page URL.
    - **Webhook URL**: For local development, use [Smee.io](https://smee.io) to generate a proxy URL (e.g., `https://smee.io/YOUR_CUSTOM_PATH`), which will forward webhooks to your local server.
    - **Webhook secret**: Generate a secret and keep it safe. This will be used to verify webhook payloads.

3. **Permissions**:
    - Under **Repository permissions**, set:
        - **Contents**: Read-only.
        - **Pull requests**: Read & write (required to comment on PRs).
    - Under **Organization permissions** (if needed):
        - **Members**: Read-only (optional, for broader analysis).

4. **Subscribe to Events**:
    - In the **Webhook** section, subscribe to:
        - **Pull request** events: To trigger the code review workflow when PRs are opened, updated, or closed.
        - **Issue comment** events: To respond to comments.

5. **Where Can This GitHub App Be Installed?**
    - Set the app to be available to **Any account** or **Only on this account** depending on your intended usage.

6. **Create GitHub App**:
    - Click **Create GitHub App** to finalize the setup.

## Step 2: Generate and Download Private Key
- After creating the GitHub App, navigate to the app's page in the **Developer settings**.
- Under **Private keys**, click **Generate a private key**.
- Download the `.pem` file and store it securely. This private key is used to authenticate requests made by your GitHub App.

## Step 3: Install the GitHub App
1. **Install on a Repository**:
    - On the GitHub App page, click **Install App**.
    - Choose the repository or organization where you want to install the app.

2. **Select Permissions**:
    - When prompted, allow access to the desired repositories to ensure the app can properly monitor and comment on pull requests.

## Step 4: Configure Environment Variables
To allow **watsonx-code-reviewer** to authenticate with GitHub, you need to configure the following environment variables:
- `GITHUB_APP_ID`: The ID of your GitHub App (available in the app settings).
- `GITHUB_PRIVATE_KEY`: The content of the `.pem` private key file.
- `GITHUB_WEBHOOK_SECRET`: The webhook secret you generated during app setup.

You can add these environment variables to your local environment or use them in your cloud deployment (e.g., IBM Cloud Code Engine).

## Step 5: Testing Webhooks Locally with Smee.io
1. **Install Smee Client**:
    - Run `npm install --global smee-client` to install the Smee client.
2. **Run Smee**:
    - Use the following command to forward events to your local machine:
      ```bash
      smee -u https://smee.io/YOUR_CUSTOM_PATH -t http://localhost:8080/webhook
      ```
    - Replace `YOUR_CUSTOM_PATH` with the path generated by Smee.io.
3. **Start Local Server**:
    - Run your local server (e.g., `main.py`) to handle webhook events at `http://localhost:8080/webhook`.

## Additional Notes
- **Security**: Ensure the private key and webhook secret are kept secure. For production deployments, use a secure secret manager like IBM Cloud Secrets Manager.
- **Testing**: Use a test repository to validate the integration before deploying to production.

By following these steps, you'll have a GitHub App properly set up to work with **watsonx-code-reviewer** for PR reviews and webhook-based interactions.

